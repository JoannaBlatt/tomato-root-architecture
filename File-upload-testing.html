<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Testing File Uploade</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <h1>Testing file upload page</h1>
    <h2>Testing if backend is even accessible</h2>
    Trying to make directories
    <!--<script src="/backend_plant_architecture/makeDir.py"></script>-->

    <!--<h2>Testing file upload using localStorage</h2>
    <input id="fileContainer" type="file">
    <input id="show" type="button" value="Show">
    <div id="imgContainer"></div>-->

    <div>
        <h2>Testing html form version</h2>
        <!-- <form
        action="http://sturdy-tribble-45v494w5rwwhq99x-8080.app.github.dev/home.html" <!-- This sends it to backend handler-->
        <!-- action="http://sturdy-tribble-45v494w5rwwhq99x-8080.app.github.dev/home.html" -->
        <!-- method="post"
            enctype="multipart/form-data"
        >
            <label for="file" >File</label>
            <input type="file" name="upload-file">
            <button class="upload">Submit Testing</button>
        </form> -->
        <input id="fileupload" type="file" name="fileupload" />
        <button id="upload-button" onclick="uploadFile()"> Upload </button>
        <!--<form method="post" enctype="multipart/form-data">
            <input name="file" type="file">
            <button type="submit">Upload</button>
        </form>-->

        <!--<h1>trying blob stuff</h1>
        <input type="button" value="Go" onclick="blobajax()">-->
    </div>

    <!--<button class="upload" id="file-upload-button" onclick="handleFileUpload()">Upload File</button>
    <input id="file-upload" type="file" style="display: none;" />-->

    <script>
//function handleFileUpload() {
//            document.getElementById('file-upload').click();
//}

//document.getElementById('file-upload').addEventListener('change', function () {
//            var file = this.files[0];

//            if (file.type !== 'text/csv') {
//                alert('Please upload a CSV file.');
//                return;
//            }

//            window.location.href = "upload.html";
//});


async function uploadFile() {
            console.log("testing testing");
            let formData = new FormData();
            formData.append("file", fileupload.files[0]);
            await fetch('temp/upload.php', {
                method: "POST",
                body: formData
            });
            alert('The file has been uploaded successfully.');
            window.location.href = "upload.html";
}


//found at https://code-boxx.com/create-save-files-javascript/
function blobajax() {
            // (A) CREATE BLOB OBJECT
            var myBlob = new Blob(["CONTENT"], { type: "text/plain" });

            // (B) FORM DATA
            var data = new FormData();
            data.append("upfile", myBlob);

            // (C) AJAX UPLOAD TO SERVER
            fetch("3b-upload.php", { method: "POST", body: data })
                .then(res => res.text())
                .then(txt => console.log(txt));
}

$('input#fileContainer').on('change', function () {
            console.log(this);

            var reader = new FileReader();
            reader.onload = function (e) {
                console.log(reader.result + '->' + typeof reader.result)
                var thisImage = reader.result;
                localStorage.setItem("imgData", thisImage);
            };
            reader.readAsDataURL(this.files[0]);
});


$('input#show').click(function () {
            var dataImage = localStorage.getItem('imgData');
            console.log(dataImage);
            var imgCtr = $('<img/>').prop('src', dataImage);
            $('div#imgContainer').append(imgCtr);
});
    </script>
</body>
</html>